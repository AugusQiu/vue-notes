虚拟dom最核心的就是patch，它将vnode渲染成真实的dom，它不是暴力覆盖原dom，而是比对新旧vnode之间有哪些不同，然后根据对比结果找出需要更新的节点进行更新，可以看出patch本身就有补丁、修补的意思  
因为dom操作的执行速度远不如js的运算速度快，我们应该最大限度地减少DOM操作
## patch介绍
对比两个vnode之间的差异只是patch的一部分，这是手段，而不是目的，patch的目的其实是修改dom节点来渲染视图  
patch的流程其实就是在做三件事：
* 创建新增的节点
* 删除已经废弃的节点
* 修改需要更新的节点
### 新增节点
* 事实上，只有那些因为状态的改变而新增的节点，在DOM中又不存在时，才需要创建一个节点并插入到DOM中，这通常会发生在首次渲染中，因为首次渲染时，DOM中不存在任何节点，所以oldVnode是不存在的  
* 当oldVnode和vnode都存在但并不是同一个节点，使用vnode创建的DOM元素替换旧的DOM元素
* 但是还有一个很常见的场景，新旧两个节点是同一个节点，这个时候需要更详细的对比操作，比如：新旧节点皆是同一个文本节点，只是文本内容变了，那我们只要重新设置oldVnode在视图中所对应的真实dom节点的文本
## 创建节点
只有三种类型的节点会被创建并插入到DOM中：元素节点、注释节点、文本节点  
* 判断vnode是否是元素节点，只需要判断它是否具有tag属性即可，接着调用createElement方法来创建真实的元素节点  
* 当一个元素节点被创建后，接着就是将它插入到指定的父节点中
* 元素渲染到视图，就是调用appendChild方法，parentNode.appendChild就是将一个元素插入到指定的父节点中  
* 元素节点通常都会有子节点(children)，创建子节点的过程就是一个递归的过程

>如果vnode的tag属性不存在，那么就是注释节点和文本节点，注释节点有个唯一的标识属性isComment，文本节点调用当前环境下的createTextNode方法，注释节点调用createComment方法  
## 删除节点
removeNode用于删除视图中的单个节点，removeVnodes用于删除一组指定的节点
````js
const nodeOps = {
    removeChild(node,child){
        node.removeChild(child)
    }
}

function removeNode(el){
    const parent = nodeOps.parentNode(el)
    if(isDef(parent)){
        nodeOps.removeChild(parent,el)
    }
}
````
## 更新节点
回顾一下，vnode的不同类型：
````js
// 注释节点
{
    text:"注释节点",
    isComment: true
}

// 文本节点
{
    text:"文本"
}
````
**注意！！！p标签、span标签这些都还是元素节点，文本节点指的是标签里的纯文本内容**

只有两个节点是同一个节点时，才需要更新元素节点，更新节点也不是暴力地使用新节点覆盖旧节点，而是通过比对找出新旧两个节点不一样的地方，针对那些不一样的地方进行更新  
### 静态节点
静态节点指的是那些一旦渲染到界面上，状态不会改变，不会发生任何变化的节点  
````js
<p>我是静态节点，我不需要发生变化</p>
````
### 新虚拟节点有文本属性
当新旧两个虚拟节点（vnode和oldVnode)不是静态节点，并且有不同属性时，根据新节点vnode是否有text属性，更新节点可以分为两种不同的情况：
* 新vnode有text属性，那么不论之前旧节点的子节点是什么，直接调用setTextConent方法（在浏览器环境下是node.textContent方法）来将视图中DOM节点的内容改为虚拟节点（vnode)的text属性所保存的文字

### 新虚拟节点无文本属性（元素节点）
如果新创建的虚拟节点没有text属性，那么它就是一个元素节点，元素节点通常会有子节点（children)属性，但也可能没有子节点，所以又分两种情况讨论
* 新创建的虚拟节点有children属性，旧虚拟节点也有children属性，那么我们要对新旧两个虚拟节点的children进行一个更加详细的对比并更新；旧虚拟节点没有children属性，那说明旧虚拟节点是一个空标签，要么是有文本的文本标签（所以元素节点往往可以包含文本节点），包含文本节点，就先清空文本再插入  
* 新创建的虚拟节点没有children属性，当新创建的虚拟节点既没有text属性也没有children属性，那么这就是个空节点，它下面没有文本内容也没有子节点，那oldVnode有什么就删什么，最后达到视图中是空标签的目的




