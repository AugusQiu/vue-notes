## 模版编译原理（编译的输出是render函数，再根据render函数生成vnode)

在vue.js中创建html并不是只有模版（template) 这一种途径，我们还可以通过手写render函数、或使用jsx来创建HTML  
render函数是创建HTML最原始的方法，模版最终会通过编译转换成render函数，render函数执行后，会得到一份vnode用于渲染真实dom  
### 如何将模版编译成渲染函数  
由于静态节点不需要总是重新渲染，所以在生成AST之后、生成渲染函数之前，需要做一个操作，那就是遍历一遍AST，给所以静态节点做一个标记，这样在虚拟dom中更新节点时，如果发现节点有这个标记，就不会重新渲染它
所以，大体逻辑上，模版编译分三个步骤：
* 1. 模版解析成AST
* 2. 遍历AST标记静态节点
* 3. 使用AST生成渲染函数

这三部分内容在模版编译中分别抽象出三个模块来实现各自的功能，分别是：
* 1. 解析器
* 2. 优化器
* 3. 代码生成器

### 解析器
其目的很明确，只实现一个功能，那就是将模版解析成AST。在解析器内部，分成了很多小解析器，其中包括过滤器解析器、文本解析器(不带变量的文本是一段纯文本，不需要使用文本解析器来解析)和HTML解析器，然后通过一条主线将这些解析器组装在一起  

最核心的是HTML解析器，主线上监听HTML解析器，每当解析到HTML标签的开始位置、结束位置、文本或者注释时，都会触发钩子函数，每次触发钩子函数，就生成一个对应的AST节点，生成AST前，会根据类型使用不同的方式生成不同的AST。例如，如果是文本节点，就生成文本类型的AST。当HTML解析器把所有模板都解析完毕之后，AST也就生成好了
### 优化器
优化器的目标是遍历AST，检测出所有静态子树（永远都不会发生变化的DOM节点）并给其打标记  
````js
<p>我是静态节点，我不需要变化</p>
````
静态节点除了首次渲染，后续不需要任何重新渲染操作  
### 代码生成器
代码生成器是模板编译的最后一步，它的作用就是将AST转换成渲染函数中的内容，这个内容可以称为“代码字符串”  
````html
<p title="qgq" @click="func">111</p>
````
生成后的代码字符串是
````js
with(this){
    return _c(
        'p',
        {
            attrs:{ "title" : "qgq" },
            on:{ "click" : func}
        },
        [ _v("111")]
    )
}

/*
   这样一个代码字符串最终导出到外界使用时，会将代码字符串放到函数里，这个函数叫做渲染函数  
   渲染函数之所以可以生成vnode，是因为代码字符串中会有很多函数调用，比如_c函数可以创建元素类型的vnode，而_v可以创建文本类型的vnode，这些都是虚拟dom提供的方法
*/
````





